From: Valentine Fatiev <valentinef@nvidia.com>
Subject: [PATCH] BACKPORT: drivers/net/ethernet/mellanox/mlx5/core/en/rx_res.c

---
 .../ethernet/mellanox/mlx5/core/en/rx_res.c   | 34 ++++++++++++++-----
 1 file changed, 26 insertions(+), 8 deletions(-)

--- a/drivers/net/ethernet/mellanox/mlx5/core/en/rx_res.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en/rx_res.c
@@ -194,7 +194,11 @@ void mlx5e_rx_res_rss_set_indir_uniform(
 }
 
 int mlx5e_rx_res_rss_get_rxfh(struct mlx5e_rx_res *res, u32 rss_idx,
-			      u32 *indir, u8 *key, u8 *hfunc, bool *symmetric)
+			      u32 *indir, u8 *key, u8 *hfunc
+#ifdef HAVE_RXH_XFRM_SYM_OR_XOR
+			      , bool *symmetric
+#endif
+			      )
 {
 	struct mlx5e_rss *rss;
 
@@ -205,12 +209,19 @@ int mlx5e_rx_res_rss_get_rxfh(struct mlx
 	if (!rss)
 		return -ENOENT;
 
-	return mlx5e_rss_get_rxfh(rss, indir, key, hfunc, symmetric);
+	return mlx5e_rss_get_rxfh(rss, indir, key, hfunc
+#ifdef HAVE_RXH_XFRM_SYM_OR_XOR
+				  , symmetric
+#endif
+				  );
 }
 
 int mlx5e_rx_res_rss_set_rxfh(struct mlx5e_rx_res *res, u32 rss_idx,
-			      const u32 *indir, const u8 *key, const u8 *hfunc,
-			      const bool *symmetric)
+			      const u32 *indir, const u8 *key, const u8 *hfunc
+#ifdef HAVE_RXH_XFRM_SYM_OR_XOR
+				, const bool *symmetric
+#endif
+			      )
 {
 	u32 *vhca_ids = get_vhca_ids(res, 0);
 	struct mlx5e_rss *rss;
@@ -222,7 +233,10 @@ int mlx5e_rx_res_rss_set_rxfh(struct mlx
 	if (!rss)
 		return -ENOENT;
 
-	return mlx5e_rss_set_rxfh(rss, indir, key, hfunc, symmetric,
+	return mlx5e_rss_set_rxfh(rss, indir, key, hfunc,
+#ifdef HAVE_RXH_XFRM_SYM_OR_XOR
+				  symmetric,
+#endif
 				  res->rss_rqns, vhca_ids, res->rss_nch);
 }
 
@@ -568,9 +582,11 @@ void mlx5e_rx_res_channels_activate(stru
 	for (ix = 0; ix < chs->num; ix++) {
 		u32 *vhca_id = get_vhca_ids(res, ix);
 
-		if (mlx5e_channels_is_xsk(chs, ix))
-			mlx5e_channels_get_xsk_rqn(chs, ix, &res->rss_rqns[ix], vhca_id);
-		else
+#ifdef HAVE_XSK_ZERO_COPY_SUPPORT
+       	if (mlx5e_channels_is_xsk(chs, ix))
+       		mlx5e_channels_get_xsk_rqn(chs, ix, &res->rss_rqns[ix], vhca_id);
+       	else
+#endif
 			mlx5e_channels_get_regular_rqn(chs, ix, &res->rss_rqns[ix], vhca_id);
 	}
 	res->rss_nch = chs->num;
@@ -620,9 +636,11 @@ void mlx5e_rx_res_xsk_update(struct mlx5
 {
 	u32 *vhca_id = get_vhca_ids(res, ix);
 
+#ifdef HAVE_XSK_ZERO_COPY_SUPPORT
 	if (xsk)
 		mlx5e_channels_get_xsk_rqn(chs, ix, &res->rss_rqns[ix], vhca_id);
 	else
+#endif
 		mlx5e_channels_get_regular_rqn(chs, ix, &res->rss_rqns[ix], vhca_id);
 
 	mlx5e_rx_res_rss_enable(res);
