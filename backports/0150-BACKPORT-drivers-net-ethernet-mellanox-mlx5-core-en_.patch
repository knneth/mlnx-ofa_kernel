From: Valentine Fatiev <valentinef@nvidia.com>
Subject: [PATCH] BACKPORT: drivers/net/ethernet/mellanox/mlx5/core/en_fs.c

---
 drivers/net/ethernet/mellanox/mlx5/core/en_fs.c | 4 ++++
 1 file changed, 4 insertions(+)

--- a/drivers/net/ethernet/mellanox/mlx5/core/en_fs.c
+++ b/drivers/net/ethernet/mellanox/mlx5/core/en_fs.c
@@ -364,6 +364,7 @@ static int mlx5e_fs_add_any_vid_rules(st
 	return mlx5e_add_vlan_rule(fs, MLX5E_VLAN_RULE_TYPE_ANY_STAG_VID, 0);
 }
 
+#ifdef HAVE_DEVLINK_TRAP_SUPPORT
 static struct mlx5_flow_handle *
 mlx5e_add_trap_rule(struct mlx5_flow_table *ft, int trap_id, int tir_num)
 {
@@ -434,6 +435,7 @@ void mlx5e_remove_mac_trap(struct mlx5e_
 		fs->l2.trap_rule = NULL;
 	}
 }
+#endif /* HAVE_DEVLINK_TRAP_SUPPORT */
 
 void mlx5e_enable_cvlan_filter(struct mlx5e_flow_steering *fs, bool promisc)
 {
@@ -559,7 +561,9 @@ static void mlx5e_del_vlan_rules(struct
 
 	WARN_ON_ONCE(fs->state_destroy);
 
+#ifdef HAVE_DEVLINK_TRAP_SUPPORT
 	mlx5e_remove_vlan_trap(fs);
+#endif /* HAVE_DEVLINK_TRAP_SUPPORT */
 
 	/* must be called after DESTROY bit is set and
 	 * set_rx_mode is called and flushed
