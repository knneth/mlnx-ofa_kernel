From: Aurelien Aptel <aaptel@nvidia.com>
Subject: [PATCH] BACKPORT: drivers/nvme/target/pci-epf.c

Change-Id: I75dac0ab1440c94caf3529854e8f7b0b014b3f9e
---
 drivers/nvme/target/pci-epf.c | 8 ++++++++
 1 file changed, 8 insertions(+)

--- a/drivers/nvme/target/pci-epf.c
+++ b/drivers/nvme/target/pci-epf.c
@@ -6,6 +6,10 @@
  * Copyright (c) 2024, Rick Wertenbroek <rick.wertenbroek@gmail.com>
  *                     REDS Institute, HEIG-VD, HES-SO, Switzerland
  */
+
+#ifdef pr_fmt
+#undef pr_fmt
+#endif
 #define pr_fmt(fmt) KBUILD_MODNAME ": " fmt
 
 #include <linux/delay.h>
@@ -641,7 +645,11 @@ static void nvmet_pci_epf_raise_irq(stru
 		 */
 		ret = pci_epc_raise_irq(epf->epc, epf->func_no, epf->vfunc_no,
 					nvme_epf->irq_type, cq->vector + 1);
+#ifdef HAVE_PCI_EPC_FEATURES_INTX_CAPABLE
 		if (!ret || !nvme_epf->epc_features->intx_capable)
+#else
+		if (!ret)
+#endif
 			break;
 		fallthrough;
 	case PCI_IRQ_INTX:
