From: Valentine Fatiev <valentinef@nvidia.com>
Subject: [PATCH] BACKPORT: drivers/nvme/common/auth.c

Change-Id: I515cf08be2c55c262f6b560be9d2dc32d81a6713
---
 drivers/nvme/common/auth.c | 6 ++++++
 1 file changed, 6 insertions(+)

--- a/drivers/nvme/common/auth.c
+++ b/drivers/nvme/common/auth.c
@@ -3,6 +3,7 @@
  * Copyright (c) 2020 Hannes Reinecke, SUSE Linux
  */
 
+#ifdef HAVE_NVME_AUTH_TRANSFORM_KEY_DHCHAP
 #include <linux/module.h>
 #include <linux/crc32.h>
 #include <linux/base64.h>
@@ -11,7 +12,9 @@
 #include <linux/unaligned.h>
 #include <crypto/hash.h>
 #include <crypto/dh.h>
+#ifdef HAVE_NVME_AUTH_DERIVE_TLS_PSK
 #include <crypto/hkdf.h>
+#endif
 #include <linux/nvme.h>
 #include <linux/nvme-auth.h>
 
@@ -721,6 +724,7 @@ EXPORT_SYMBOL_GPL(nvme_auth_generate_dig
  * Returns 0 on success with a valid psk pointer in @ret_psk or a negative
  * error number otherwise.
  */
+#ifdef HAVE_NVME_AUTH_DERIVE_TLS_PSK
 int nvme_auth_derive_tls_psk(int hmac_id, u8 *psk, size_t psk_len,
 		u8 *psk_digest, u8 **ret_psk)
 {
@@ -807,6 +811,8 @@ out_free_shash:
 	return ret;
 }
 EXPORT_SYMBOL_GPL(nvme_auth_derive_tls_psk);
+#endif
 
+#endif /* HAVE_NVME_AUTH_TRANSFORM_KEY_DHCHAP */
 MODULE_DESCRIPTION("NVMe Authentication framework");
 MODULE_LICENSE("GPL v2");
